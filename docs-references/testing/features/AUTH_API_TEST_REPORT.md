# Authentication & Password Reset API - Unit Test Report

**Version:** 1.0
**Last Updated:** 2025-12-19
**Feature:** Authentication, Registration (OTP), Password Reset (OTP)
**Test Type:** Unit Test (API Controller)

---

## 1. Overview

### 1.1 Feature Description

Hệ thống Authentication hỗ trợ các quy trình bảo mật dựa trên OTP và JWT:
- **Đăng nhập đa vai trò**: Hỗ trợ PET_OWNER, VET, CLINIC_MANAGER.
- **Đăng ký với OTP**: Quy trình 2 bước (Gửi OTP -> Xác thực & Tạo tài khoản).
- **Quên mật khẩu với OTP**: Quy trình 2 bước để đặt lại mật khẩu an toàn.
- **Google Sign-In**: Đăng nhập nhanh thông qua Google ID Token.

### 1.2 Applicable Roles

| Role | Access | Note |
|------|--------|------|
| ALL | Full | Tất cả người dùng đều có quyền truy cập các API Auth |

### 1.3 API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/auth/login` | Đăng nhập truyền thống (username/password) |
| POST | `/auth/register/send-otp` | Bước 1: Gửi mã OTP đăng ký |
| POST | `/auth/register/verify-otp` | Bước 2: Xác thực OTP và hoàn tất đăng ký |
| POST | `/auth/forgot-password` | Bước 1: Gửi mã OTP quên mật khẩu |
| POST | `/auth/reset-password` | Bước 2: Xác thực OTP và đặt mật khẩu mới |
| POST | `/auth/google` | Đăng nhập/Đăng ký qua Google |

---

## 2. Test Environment

### 2.1 Test Configuration

| Item | Value |
|------|-------|
| Test Framework | JUnit 5 + Mockito |
| Test Type | Unit Test (Pure Mockito) |
| Dependencies | Mocked (AuthService, RegistrationOtpService, PasswordResetService) |

### 2.2 Test File Location

```
backend-spring/petties/src/test/java/com/petties/petties/controller/
├── AuthControllerAuthTest.java
└── AuthControllerPasswordResetTest.java
```

---

## 3. Test Cases - Authentication

### 3.1 Login by Role

#### TC-AUTH-001: Login as PET_OWNER
- **Method**: `shouldLoginSuccessfullyAsPetOwner()`
- **Expected**: Status 200, role: "PET_OWNER"
- **Status**: PASSED

#### TC-AUTH-002: Login as VET
- **Method**: `shouldLoginSuccessfullyAsVet()`
- **Expected**: Status 200, role: "VET"
- **Status**: PASSED

#### TC-AUTH-003: Login as CLINIC_MANAGER
- **Method**: `shouldLoginSuccessfullyAsClinicManager()`
- **Expected**: Status 200, role: "CLINIC_MANAGER"
- **Status**: PASSED

### 3.2 Registration (OTP Flow)

#### TC-AUTH-004: Send Registration OTP
- **Method**: `shouldSendRegistrationOtpSuccessfully()`
- **Expected**: Status 200, returns SendOtpResponse
- **Status**: PASSED

#### TC-AUTH-005: Verify OTP & Complete Registration
- **Method**: `shouldVerifyOtpAndRegisterSuccessfully()`
- **Expected**: Status 201, returns AuthResponse (Tokens)
- **Status**: PASSED

### 3.3 Social Login

#### TC-AUTH-006: Google Sign-In
- **Method**: `shouldGoogleSignInSuccessfully()`
- **Expected**: Status 200, returns AuthResponse
- **Status**: PASSED

---

## 4. Test Cases - Password Reset

### 4.1 Forgot Password Flow

#### TC-PWD-001: Request Password Reset (Send OTP)
- **Method**: `shouldSendOtpSuccessfully()`
- **Expected**: Status 200, return SendOtpResponse
- **Status**: PASSED

#### TC-PWD-002: Reset Password with Valid OTP
- **Method**: `shouldResetPasswordSuccessfully()`
- **Expected**: Status 200, returns success message
- **Status**: PASSED

#### TC-PWD-003: Resend Password Reset OTP
- **Method**: `shouldResendOtpSuccessfully()`
- **Expected**: Status 200, returns new expiry info
- **Status**: PASSED

---

## 5. Test Execution Summary

### 5.1 Results (Latest Run)

| Metric | Value |
|--------|-------|
| **Total Test Cases** | 9 |
| **Passed** | 9 |
| **Pass Rate** | 100% |

### 5.2 Run Command

```bash
mvn test -Dtest=AuthControllerAuthTest,AuthControllerPasswordResetTest
```

---

**Document Status:** Complete
**Reviewed By:** Auto-generated by AI Assistant
